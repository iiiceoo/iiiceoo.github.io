# RBAC

>Kubernetes ä¸­æ‰€æœ‰çš„ API å¯¹è±¡ï¼Œå‡ä¿å­˜äº ETCD ä¸­ã€‚æ¯å½“éœ€è¦å¯¹è¿™äº› API å¯¹è±¡è¿›è¡Œæ“ä½œæ—¶ï¼Œä¸€å®šéƒ½æ˜¯é€šè¿‡è®¿é—® API Server å®ç°çš„ã€‚å…¶ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„åŸå› ï¼Œå°±æ˜¯ç”¨æˆ·éœ€è¦ API Server æ¥è¿›è¡Œæˆæƒå·¥ä½œã€‚
>
>Kubernetes é¡¹ç›®ä¸­ï¼Œè´Ÿè´£å®Œæˆ**é‰´æƒå·¥ä½œï¼ˆAuthorizationï¼‰**çš„æœºåˆ¶ï¼Œå³ **RBACï¼ˆRole-Based Access Controlï¼‰**ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ã€‚



## Kubernetes API è¯·æ±‚è®¿é—®æ§åˆ¶

åœ¨äº†è§£ **RBAC** ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆç®€è¦çš„ä»‹ç»ä¸‹Kubernetes API è¯·æ±‚**ä»å‘èµ·åˆ°æŒä¹…åŒ–å…¥åº“**çš„ä¸€ä¸ªæµç¨‹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œ**RBAC** è´Ÿè´£çš„**æˆæƒå·¥ä½œï¼ˆAuthorizationï¼‰**ä»…æ˜¯å›¾ä¸­çš„ç¬¬äºŒæ­¥ã€‚ä¸€èˆ¬çš„ï¼Œè¿™äº›è¯·æ±‚é€šå¸¸åˆ†ä¸ºä¸¤ç±»ï¼š

- **äººæœºäº¤äº’**ï¼Œå³å¤§å®¶éå¸¸ç†Ÿæ‚‰çš„ kubectl äº¤äº’ API Server çš„è¿‡ç¨‹ã€‚
- *Pod* ä¸­çš„**ä¸šåŠ¡é€»è¾‘**ä¸ API Server ä¹‹é—´çš„äº¤äº’ã€‚

![image-20210608142528182](./img/image-20210608142528182.png)

å½“ API Server æ”¶åˆ°è¯·æ±‚åï¼Œå°±ä¼šè¿›å…¥**è®¿é—®æ§åˆ¶**æµç¨‹ï¼š

1. **è®¤è¯ï¼ˆAuthenticationï¼‰**ï¼šAPI Server åˆ¤æ–­**è¯·æ±‚ç”¨æˆ·**æ˜¯å¦ä¸ºèƒ½å¤Ÿè®¿é—®é›†ç¾¤çš„**åˆæ³•ç”¨æˆ·**ã€‚è‹¥ç”¨æˆ·ä¸º**éæ³•ç”¨æˆ·**ï¼ŒAPI Server åˆ™è¿”å› **401** çš„çŠ¶æ€ç ï¼Œå¹¶ç»ˆæ­¢è¯¥è¯·æ±‚ã€‚
2. **é‰´æƒï¼ˆAuthorizationï¼‰**ï¼šAPI Server åˆ¤æ–­ç”¨æˆ·**æ˜¯å¦æœ‰æƒé™è¿›è¡Œè¯·æ±‚ä¸­çš„æ“ä½œ**ã€‚è‹¥æ— æƒæ“ä½œï¼ŒAPI Server è¿”å› **403** çš„çŠ¶æ€ç ï¼ŒåŒæ ·ç»ˆæ­¢è¯¥è¯·æ±‚ã€‚
3. **å‡†å…¥æ§åˆ¶ï¼ˆAdmissionControlï¼‰**ï¼šAPI Server ä¸­çš„**å‡†å…¥æ§åˆ¶å™¨ï¼ˆAdmission Controlï¼‰** åˆ¤æ–­è¯·æ±‚æ˜¯å¦æ˜¯ä¸€ä¸ª**å®‰å…¨åˆè§„**çš„è¯·æ±‚ã€‚å¸¸è§çš„ï¼Œ*ResourceQuota* ä»¥åŠ *LimitRanger* å°±ç”±å‡†å…¥æ§åˆ¶å™¨æ ¡éªŒã€‚
4. æœ€åï¼Œæˆ‘ä»¬çš„è¯·æ±‚å°†ä¼šè½¬æ¢ä¸ºä¸€ä¸ª Kubernetes API å¯¹è±¡ç›¸åº”çš„**å˜æ›´è¯·æ±‚**ï¼Œæœ€ç»ˆæŒä¹…åŒ–åˆ° ETCD ä¸­ã€‚



## Kubernetes è®¤è¯

### ç›¸å…³æ¦‚å¿µ

ç†è§£ Kubernetes è®¤è¯ï¼Œ**æ•°å­—è¯ä¹¦**ç›¸å…³çš„çŸ¥è¯†æ˜¯å¿…ä¸å¯å°‘çš„ã€‚**æ•°å­—è¯ä¹¦**å¸¸è§äº **TLS/SSL** ä¸­çš„è®¤è¯æ–‡ä»¶ã€‚ç›¸å…³æ¦‚å¿µè§£é‡Šï¼š

- **TLSï¼ˆTransport Layer Securityï¼‰**ï¼š**ç½‘ç»œé€šä¿¡å®‰å…¨åè®®**ï¼Œä¼ è¾“å±‚å®‰å…¨åè®®ï¼Œå…¶å‰èº«ä¸º **SSL**ã€‚
- **SSLï¼ˆSecure Socket Layerï¼‰**ï¼š**ç½‘ç»œé€šä¿¡å®‰å…¨åè®®**ï¼Œå®‰å…¨å¥—æ¥å­—åè®®ï¼Œå…¶ç»§ä»»è€…ä¸º **TLS**ã€‚
- **OpenSSL**ï¼šå¦‚æœæŠŠ **SSL** è§„èŒƒç±»æ¯”ä¸ºé¢å‘å¯¹è±¡ä¸­çš„**æ¥å£**çš„è¯ï¼Œ**OpenSSL** å°±æ˜¯è¯¥æ¥å£çš„**å®ç°**ã€‚
- **CAï¼ˆCertificate Authorityï¼‰**ï¼šè¯ä¹¦é¢å‘æœºæ„ã€‚è´Ÿè´£**å‘æ”¾å’Œç®¡ç†æ•°å­—è¯ä¹¦çš„æƒå¨æœºæ„**ï¼Œå¹¶ä½œä¸ºç”µå­å•†åŠ¡äº¤æ˜“ä¸­å—ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹ï¼Œæ‰¿æ‹…å…¬é’¥ä½“ç³»ä¸­å…¬é’¥çš„åˆæ³•æ€§æ£€éªŒçš„è´£ä»»ã€‚
- **éå¯¹ç§°åŠ å¯†ç®—æ³•**ï¼š éå¯¹ç§°åŠ å¯†ç®—æ³•éœ€è¦ä¸¤ä¸ªå¯†é’¥ï¼š**å…¬é’¥ï¼ˆpublickeyï¼‰**ä¸**ç§é’¥ï¼ˆprivatekeyï¼‰**ã€‚é€šå¸¸çš„ï¼Œå…¬é’¥ç”¨äº**æ•°æ®åŠ å¯†**ä¸**ç­¾åæ ¡éªŒ**ï¼›ç§é’¥ç”¨äº**æ•°æ®è§£å¯†**ä¸**æ•°å­—ç­¾å**ã€‚ä¸»è¦ç®—æ³•æœ‰ **RSA**ã€‚
- **.key æ–‡ä»¶**ï¼šç§é’¥ã€‚
- **.csr æ–‡ä»¶ï¼ˆCertificate Signing Requestï¼‰**ï¼šè¯ä¹¦ç­¾åè¯·æ±‚ã€‚è¯·æ±‚ç”Ÿæˆè¯ä¹¦æ—¶éœ€è¦æŠŠè¯¥ç±»æ–‡ä»¶æäº¤ç»™ **CA**ã€‚
- **.crt æ–‡ä»¶ï¼ˆCertificateï¼‰**ï¼šåŒ **.cer æ–‡ä»¶**ï¼Œå³è¯ä¹¦ã€‚ç”± **CA** é¢å‘ï¼Œå†…å«è¯ä¹¦æŒæœ‰è€…çš„**å…¬é’¥**ä»¥åŠ**ç”¨æˆ·æˆ–è®¾å¤‡**ä¿¡æ¯ã€‚
- **X.509**ï¼šä¸€ç§**è¯ä¹¦æ ¼å¼**ï¼Œå¯¹äº **X.509 è¯ä¹¦**æ¥è¯´ï¼Œè®¤è¯è€…æ€»æ˜¯ **CA** æˆ–ç”± **CA è®¤è¯çš„äºº**ã€‚ä¸€ä»½ **X.509 è¯ä¹¦**æ˜¯ä¸€äº›æ ‡å‡†å­—æ®µçš„é›†åˆï¼ŒåŒ…å«æœ‰å…³**ç”¨æˆ·æˆ–è®¾å¤‡**åŠå…¶ç›¸åº”**å…¬é’¥**çš„ä¿¡æ¯ã€‚æ ¹æ®æ–‡ä»¶å†…å®¹ç¼–ç æ ¼å¼ï¼Œå¯åˆ†ä¸ºä»¥ä¸‹äºŒç§ï¼š
  1. **PEM**ï¼šå¯é˜…è¯»ï¼Œé€šå¸¸ä»¥ "-----BEGIN..." å¼€å¤´ï¼Œ"-----END..." ç»“å°¾ï¼Œå†…å®¹æ˜¯ **BASE64** ç¼–ç ã€‚**Apache** å’Œ **NIX** æœåŠ¡å™¨åå‘äºä½¿ç”¨è¿™ç§ç¼–ç æ ¼å¼ã€‚
  2. **DER**ï¼šäºŒè¿›åˆ¶æ–‡ä»¶ã€‚**Java** å’Œ **Windows** æœåŠ¡å™¨åå‘äºä½¿ç”¨è¿™ç§ç¼–ç æ ¼å¼ã€‚



å…¶å®ï¼Œåœ¨ä½ è®¿é—® **HTTPS** ç±»å‹çš„ç½‘ç«™æ—¶ï¼Œå°±æ¶‰åŠåˆ°äº† **TLS/SSL** çš„**ä¼ è¾“åŠ å¯†**å’Œ**èº«ä»½è®¤è¯**ã€‚**HTTPS** å…¨ç§° *Hyper Text Transfer Protocol over Secure Socket Layer*ï¼Œé¡¾åæ€ä¹‰ **HTTP + SSL**ã€‚

![image-20210609091304715](./img/image-20210609091304715.png)

è¿™æ˜¯ *github.com* çš„ **HTTPS** æ ‡å¿—ã€‚é€šå¸¸çš„ï¼Œ **HTTPS** ç±»å‹çš„ç½‘ç«™ï¼Œæ ¹æ®ä½ ä½¿ç”¨çš„æµè§ˆå™¨å·®å¼‚ï¼Œç½‘å€èƒŒæ™¯ä¼šå‘ˆç°**ç»¿è‰²**ï¼Œæˆ–è€…ä¼šåœ¨å¤´éƒ¨æœ‰ä¸€æŠŠå°ğŸ”’ã€‚ä¸å¦¨æ¥çœ‹çœ‹å®ƒçš„è¯ä¹¦ã€‚

![image-20210609091521115](./img/image-20210609091521115.png)

è¿™å°±æ˜¯ä¸€ä»½å¾ˆæ ‡å‡†çš„**è¯ä¹¦**ï¼Œåœ¨ Windows ä¸ŠåŒå‡»ä»»æ„ .crt æ–‡ä»¶ä¹Ÿèƒ½çœ‹åˆ°ç±»ä¼¼çš„å¯¹è¯æ¡†ã€‚ä¸Šé¢å¾ˆæ¸…æ¥šçš„è®°è½½äº† **CA**ï¼Œ**è¢«é¢å‘è€…**ï¼Œè¯ä¹¦**æœ‰æ•ˆæ—¥æœŸ**ç­‰ä¿¡æ¯ã€‚åŒæ ·çš„ï¼Œ**è¯¦ç»†ä¿¡æ¯**ä¸­å¯ä»¥çœ‹åˆ°æ›´å¤šã€‚

![image-20210609092052560](./img/image-20210609092052560.png)

è¿™ä»½è¯ä¹¦ï¼Œå…¶å®å°±æ˜¯ *github.com* çš„å»ºç«™è€…ï¼Œé€šè¿‡ **OpenSSL** ç­‰ç›¸å…³å·¥å…·ç”Ÿæˆç§é’¥ï¼ˆ.key æ–‡ä»¶ï¼‰ä¸å¯¹åº”çš„ .csr æ–‡ä»¶åï¼Œå°† .csr æ–‡ä»¶ + ğŸ’´ æäº¤ç»™ CAï¼Œç„¶å CA æ‰¹å‡†ä¸é¢å‘çš„ã€‚

å®ƒè¯æ˜äº† *github.com* è‡ªèº«æ˜¯äº’è”ç½‘ç•Œçš„ â€**è‰¯æ°‘**â€œï¼ŒåŒæ—¶ï¼Œå®ƒä¼šæŠŠè¿™ä»½è¯ä¹¦å‘é€ç»™æ¯ä¸€ä¸ªè®¿é—®è‡ªå·±çš„**æµè§ˆå™¨**ï¼Œæµè§ˆå™¨åˆ™ä¼šåˆ¤æ–­é¢å‘è¯¥è¯ä¹¦çš„ CA æ˜¯å¦**å€¼å¾—ä¿¡ä»»**ï¼Œè‹¥å€¼å¾—ä¿¡ä»»ï¼Œè¿™ä»½è¯ä¹¦åˆ™è¢«**æŒä¹…åŒ–**åˆ°**ç”¨æˆ·å½“å‰è®¾å¤‡**çš„ç£ç›˜ä¸­ã€‚ä¹‹åï¼Œæµè§ˆå™¨å€Ÿç”±è¯ä¹¦ä¸­çš„**å…¬é’¥**ä¸ *github.com* çš„**æœåŠ¡å™¨**å¼€å§‹ **TLS** æ¡æ‰‹ï¼Œå…·ä½“ç»†èŠ‚ä¸å†å±•å¼€ã€‚

çœ‹åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥èƒ½å¯¹ä¸Šè¿°ç½—åˆ—çš„åè¯æœ‰æ›´æ·±åˆ»çš„ç†è§£ï¼Œå¦‚æœæ„Ÿå…´è¶£ï¼Œä¹‹åä½ å®Œå…¨å¯ä»¥é€šè¿‡ **OpenSSL** ç”Ÿæˆç§é’¥ï¼Œ.csr æ–‡ä»¶ï¼ŒCA è¯ä¹¦ï¼Œä¸ºè‡ªå·±çš„æœåŠ¡å™¨ä¹Ÿé¢å‘ä¸€ä»½è¯ä¹¦ï¼Œä¸è¿‡è¿™æ ·åšæ˜¯è‚¯å®šä¸èƒ½è®©ä½ çš„ç½‘ç«™ä¹Ÿæœ‰ä¸€æŠŠå°ğŸ”’çš„ï¼Œå¾—å‘ CA åŠ  ğŸ’´ã€‚



### Kubernetes ç”¨æˆ·æ¨¡å‹

å¯¹äºè®¤è¯æ¥è¯´ï¼Œé¦–è¦çš„å°±æ˜¯ç¡®å®šè¯·æ±‚çš„**å‘èµ·æ–¹**æ˜¯è°ï¼Œå¹¶æœ€ç»ˆé€šè¿‡**è®¤è¯è¿‡ç¨‹**å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ª**ç³»ç»Ÿå¯è¯†åˆ«çš„ç”¨æˆ·æ¨¡å‹**ï¼Œå…¶å¯ç”¨äºä¹‹åçš„**é‰´æƒ**ç­‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒKubernetes è‡ªèº«æ˜¯æ²¡æœ‰**ç”¨æˆ·ç®¡ç†èƒ½åŠ›**çš„ï¼

å¦‚ä½•ç†è§£**ç”¨æˆ·ç®¡ç†èƒ½åŠ›**ï¼Ÿå³æˆ‘ä»¬æ— æ³•åƒæ“ä½œ *Pod* ä¸€æ ·ï¼Œé€šè¿‡ API çš„æ–¹å¼åˆ›å»ºåˆ é™¤ä¸€ä¸ªâ€**ç”¨æˆ·å®ä¾‹**â€œã€‚åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•åœ¨ ETCD ä¸­æ‰¾åˆ°**ç”¨æˆ·**å¯¹åº”çš„**å­˜å‚¨å¯¹è±¡**ã€‚

é‚£ä¹ˆåœ¨ Kubernetes çš„**è®¿é—®æ§åˆ¶æµç¨‹**ä¸­ï¼Œ**ç”¨æˆ·æ¨¡å‹**æ˜¯å¦‚ä½•äº§ç”Ÿçš„å‘¢ï¼Ÿç­”æ¡ˆå°±åœ¨è¯·æ±‚æ–¹çš„**è®¿é—®æ§åˆ¶å‡­è¯**ä¸­ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„ kubeconfig ä¸­çš„**è¯ä¹¦**ï¼Œæˆ–è€…æ˜¯ *Pod* ä¸­å¼•å…¥çš„ *ServerAccount*ã€‚åœ¨ç»è¿‡ Kubernetes **è®¤è¯æµç¨‹**ä¹‹åï¼ŒAPI Server ä¼šå°†**è¯·æ±‚å‡­è¯**ä¸­çš„**ç”¨æˆ·èº«ä»½**è½¬åŒ–ä¸ºè¯¸å¦‚ *User* å’Œ *Groups* è¿™æ ·çš„**ç”¨æˆ·æ¨¡å‹**ã€‚åœ¨éšåçš„**é‰´æƒæ“ä½œ**å’Œ**å‡†å…¥æ§åˆ¶**æµç¨‹ä¸­ï¼ŒAPI Server ä¼šå†æ¬¡ä½¿ç”¨åˆ°è¿™äº›**ç”¨æˆ·æ¨¡å‹å®ä¾‹**ã€‚



Kubernetes ä¸»è¦æ”¯æŒçš„**è¯·æ±‚è®¤è¯æ–¹å¼**ï¼š

- **Basic è®¤è¯**ï¼š**ç®¡ç†å‘˜**å°† Username å’Œ Password ç»„æˆçš„**ç™½åå•**æ”¾ç½®åœ¨ API Server è¯»å–çš„**é™æ€é…ç½®æ–‡ä»¶**ä¸‹è¿›è¡Œè®¤è¯ã€‚è¯¥æ–¹å¼ä¸€èˆ¬ç”¨äº**æµ‹è¯•**åœºæ™¯ï¼Œåœ¨å®‰å…¨æ–¹é¢ä¸æ¨èä¸”ä¸å¯æ‹“å±•çš„ä¸€ç§æ–¹å¼ã€‚

- **X.509 è¯ä¹¦è®¤è¯**ï¼šAPI Server ä¸­ç›¸å¯¹åº”ç”¨**è¾ƒå¤š**çš„ä½¿ç”¨æ–¹å¼ã€‚**è®¿é—®è€…**ä¼šä½¿ç”¨ç”±**é›†ç¾¤ CA** ç­¾å‘çš„ï¼Œæˆ–æ˜¯æ·»åŠ åœ¨ **API Server Client CA** ä¸­çš„**æˆä¿¡ CA** ç­¾å‘çš„**å®¢æˆ·ç«¯è¯ä¹¦**å»è®¿é—® API Serverã€‚API Server **æœåŠ¡ç«¯**åœ¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œåˆ™å¼€å§‹ **TLS** æ¡æ‰‹æµç¨‹ã€‚

  é™¤äº†éªŒè¯è¯ä¹¦çš„**åˆæ³•æ€§**ï¼ŒAPI Server è¿˜ä¼šæ ¡éªŒ**å®¢æˆ·ç«¯è¯ä¹¦**çš„**è¯·æ±‚æºåœ°å€**ç­‰ä¿¡æ¯ã€‚å¼€å¯åŒå‘è®¤è¯ï¼Œ**X.509 è®¤è¯**æ˜¯ä¸€ä¸ªæ¯”è¾ƒå®‰å…¨çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯ Kubernetes ç»„ä»¶ä¹‹é—´**é»˜è®¤ä½¿ç”¨çš„è®¤è¯æ–¹å¼**ï¼ŒåŒæ—¶è¿˜æ˜¯ kubectl å®¢æˆ·ç«¯å¯¹åº”çš„ kubeconfig ä¸­ç»å¸¸ä½¿ç”¨åˆ°çš„**è®¿é—®å‡­è¯**ã€‚

- **Bearer Tokensï¼ˆJSON Web Tokensï¼‰**ï¼šè¯¥æ–¹å¼çš„ **Tokens** æ˜¯é€šç”¨çš„ **JWT** å½¢å¼ï¼Œå…¶ä¸­åŒ…å«äº†**ç­¾å‘è€…**ã€**ç”¨æˆ·èº«ä»½**ã€**è¿‡æœŸæ—¶é—´**ç­‰å¤šç§å…ƒä¿¡æ¯ã€‚å®ƒçš„è®¤è¯æ–¹å¼ä¹Ÿæ˜¯å¸¸è§çš„**ç§é’¥åŠ ç­¾**ï¼Œ**å…¬é’¥éªŒç­¾**çš„ä¸€ä¸ªåŸºæœ¬æµç¨‹ã€‚

  1. **Service Account**ï¼šæ¯ä¸ª *Pod* å‡ä¼šä½¿ç”¨ä¸€ä¸ª *ServiceAccount*ï¼Œ*ServiceAccount* ä¸­å°±ä¼šè‡ªåŠ¨ç»‘å®šä¸€ä¸ª**ç­¾ååçš„ JWT Token** ç”¨äºè¯·æ±‚ API Serverã€‚
  2. **OpenID Connect**ï¼šAPI Server è¿˜æ”¯æŒåŸºäº OpenID åè®®çš„ Token è®¤è¯ï¼Œå¯ä»¥é€šè¿‡å¯¹ API Server çš„é…ç½®è¿æ¥ä¸€ä¸ªæŒ‡å®šçš„**å¤–éƒ¨ IDP**ã€‚åŒæ—¶ï¼Œå¯ä»¥é€šè¿‡ Keycloakï¼ŒDex è¿™æ ·çš„å¼€æºæœåŠ¡æ¥ç®¡ç† IDPï¼Œè¯·æ±‚è€…å¯ä»¥æŒ‰ç…§è‡ªå·±ç†Ÿæ‚‰çš„æ–¹å¼**åœ¨åŸèº«ä»½è®¤è¯æœåŠ¡ä¸Šè¿›è¡Œç™»å½•è®¤è¯**ï¼Œå¹¶æœ€ç»ˆè¿”å›ä¸€ä¸ª**ç›¸åº”çš„ JWT token**ã€‚
  3. **Webhooks**ï¼šå¯ä»¥ä½¿ç”¨ Webhooks çš„æ–¹å¼ï¼Œå°†è¯·æ±‚çš„ Token å‘é€åˆ°æŒ‡å®š**å¤–éƒ¨æœåŠ¡**è¿›è¡Œ **Token éªŒç­¾**ã€‚



### X.509 è¯ä¹¦

å¯¹äºä¸€ä¸ª**é›†ç¾¤è¯ä¹¦ä½“ç³»**æ¥è¯´ï¼Œ**æ ¹ CA** æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„**è¯ä¹¦å¯¹**ã€‚å®ƒä¼šè¢«é»˜è®¤æ”¾ç½®åœ¨é›†ç¾¤ **Master** èŠ‚ç‚¹ä¸Šçš„ **/etc/kubernetes/pki/** ç›®å½•ä¸‹ã€‚

![image-20210609111818279](./img/image-20210609111818279.png)

å…¶ä¸­ **ca.crt** å³**å…¬é’¥**ï¼Œ**ca.key** å°±æ˜¯**ç§é’¥**ã€‚**é›†ç¾¤ä¸­æ‰€æœ‰ç»„ä»¶ä¹‹é—´çš„é€šè®¯ç”¨åˆ°çš„è¯ä¹¦ï¼Œå…¶å®éƒ½æ˜¯ç”±é›†ç¾¤æ ¹ CA æ¥ç­¾å‘çš„ã€‚**



åœ¨è¯ä¹¦ä¸­æœ‰ä¸¤ä¸ª**èº«ä»½å‡­è¯ç›¸å…³çš„é‡è¦å­—æ®µ**ï¼šä¸€ä¸ªæ˜¯ **CN**ï¼Œä¸€ä¸ªæ˜¯ **O**ã€‚é€šè¿‡ `openssl` å‘½ä»¤æ¥è¿›è¡Œè¯ä¹¦çš„è§£æã€‚

```bash
openssl x509 -in apiserver.crt -noout -text
```

![image-20210609112904315](./img/image-20210609112904315.png)

- **CNï¼ˆComman Nameï¼‰**ï¼šAPI Server åœ¨è®¤è¯è¿‡ç¨‹ä¸­å°†å…¶ä½œä¸º**ç”¨æˆ· *User***ã€‚
- **Oï¼ˆOrganizationï¼‰**ï¼šAPI Server åœ¨è®¤è¯è¿‡ç¨‹ä¸­å°†å…¶ä½œä¸º**ç»„ *Group***ã€‚



æ¯ä¸€ä¸ª Kubernetes ç³»ç»Ÿç»„ä»¶éƒ½åœ¨**é›†ç¾¤åˆ›å»º**æ—¶ç­¾å‘äº†è‡ªèº«å¯¹åº”çš„**å®¢æˆ·ç«¯è¯ä¹¦**ã€‚

| ç»„ä»¶               | Comman Name                    | Organization |
| ------------------ | ------------------------------ | ------------ |
| controller-manager | system:kube-controller-manager |              |
| scheduler          | system:kube-scheduler          |              |
| kube-proxy         | system:kube-proxy              |              |
| kubelet            | system:node:$(node-hostname)   | system:nodes |



### è¯ä¹¦ç­¾å‘

Kubernetes é›†ç¾¤æœ¬èº«å°±æä¾›äº†**è¯ä¹¦ç­¾å‘çš„ API**ï¼Œç”¨äºå‘ **CA** è¯·æ±‚å¹¶è·å– **X.509 è¯ä¹¦**ã€‚*CertificateSigningRequest*ï¼ˆ*CSR*ï¼‰èµ„æºç”¨æ¥å‘æŒ‡å®šçš„ç­¾åè€…ç”³è¯·è¯ä¹¦ç­¾åã€‚

åˆ›å»º *CSR* ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå€ŸåŠ© **OpenSSL** ç­‰å·¥å…·ç”Ÿæˆ**ç§é’¥**ã€‚

```bash
openssl genrsa -out test.key 2048
```

![image-20210609141303087](./img/image-20210609141303087.png)



ç”Ÿæˆ **.csr æ–‡ä»¶**ã€‚

```bash
openssl req -new -key test.key -out test.csr -subj "/CN=xzq/O=people"
```

![image-20210609141454871](./img/image-20210609141454871.png)



åŸºäºè¯¥ **.csr æ–‡ä»¶**åˆ›å»º *CSR* èµ„æºã€‚

```yaml
apiVersion: certificates.k8s.io/v1beta1
kind: CertificateSigningRequest
metadata:
  name: test
spec:
  request: $(cat test.csr | base64 | tr -d "\n")
  usages:
  - digital signature
  - key encipherment
  - server auth
```



API Server åˆ™ä¼šæ ¹æ®è¯·æ±‚ï¼Œä»¥ *CSR* èµ„æºæ¨¡å‹çš„å½¢å¼åˆ›å»ºå¯¹åº”çš„**ç­¾å‘è¯·æ±‚å®ä¾‹**ã€‚åˆšå¼€å§‹åˆ›å»ºçš„**ç­¾å‘å®ä¾‹**éƒ½ä¼šå¤„äº pending çŠ¶æ€ã€‚

```bash
kubectl get csr
```

![image-20210609142133488](./img/image-20210609142133488.png)

```bash
kubectl describe csr test
```

![image-20210609142302801](./img/image-20210609142302801.png)



ç›´åˆ°æœ‰æƒé™çš„**ç®¡ç†å‘˜**è¿›è¡Œ**å®¡æ‰¹**åï¼Œè¯¥ *CSR* æ‰ä¼šå¤„äº approved çš„çŠ¶æ€ï¼Œè¯·æ±‚å¯¹åº”çš„è¯ä¹¦å°±ä¼šè¢«ç­¾å‘ã€‚

```bash
kubectl certificate approve test
```

![image-20210609142409776](./img/image-20210609142409776.png)

åŒæ—¶ï¼Œå¯¹äºé›†ç¾¤ç®¡ç†å‘˜ï¼Œä»–è¿˜å¯ä»¥ç›´æ¥è¯»å–**é›†ç¾¤æ ¹ CA**ï¼Œé€šè¿‡ **X.509** çš„ **.csr æ–‡ä»¶**ç­¾å‘è¯ä¹¦ï¼Œæ‰€ä»¥ä»–å¯ä»¥æ— éœ€å®šä¹‰æˆ–å®¡æ‰¹ *CSR*ã€‚

```bash
openssl x509 -req in test.csr -CA CA_LOCATION/ca.crt -Cakey CA_LOCATION/ca.key -Cacreateserial -out test.crt -day 365
```



### Service Accounts

*ServiceAccount* ä¹Ÿæ˜¯ API Server ä¸­åº”ç”¨æ¯”è¾ƒå¹¿æ³›çš„ä¸€ç§æ–¹å¼ã€‚å¯¹äº *ServiceAccount* æ¥è¯´ï¼Œå®ƒæ˜¯ Kubernetes ä¸­å”¯ä¸€èƒ½å¤Ÿé€šè¿‡ API æ–¹å¼ç®¡ç†çš„ **API Server è®¿é—®å‡­è¯**ã€‚

å½“ä¸€ä¸ª *Namespace* åˆ›å»ºå®Œæˆåï¼Œä¼šåŒæ—¶åœ¨è¯¥ *Namespace* ä¸‹ç”Ÿæˆåä¸º **default** çš„ä¸€ä¸ª *ServiceAccount* å’Œå¯¹åº”çš„ *Secret*ã€‚åŒæ ·çš„ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡ API åˆ›å»ºå…¶ä»–åç§°çš„ *ServiceAccount*ï¼Œå¹¶åœ¨è¯¥ *Namespace* ä¸‹æŒ‚è½½åˆ°å¾…è¿è¡Œçš„ *pod* ä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºå·²ç»åˆ›å»ºçš„ *Pod*ï¼Œæ˜¯**ä¸èƒ½æ›´æ–°**å…¶å·²ç»æŒ‚è½½çš„ *ServiceAccount* ä¸­çš„å†…å®¹çš„ã€‚



æŸ¥çœ‹ä¸€ä¸ª **default** *Namespace* ä¸‹çš„ *ServiceAccount*ã€‚å¾ˆæ¸…æ¥šçš„çœ‹åˆ°å®ƒä¸ä¸€ä¸ª *Secret* ç»‘å®šã€‚

```bash
kubectl get sa/nfs-client-provisioner -o yaml
```

![image-20210609145721131](./img/image-20210609145721131.png)



æŸ¥çœ‹è¿™ä¸ªå¯¹åº”çš„ *Secret*ã€‚å…¶ä¸­ `data.token` å­—æ®µæ˜¯ç»è¿‡äº† **base64 ç¼–ç **çš„ **JWT æ ¼å¼çš„è®¤è¯ token**ï¼Œ`data.ca.crt` å­—æ®µåˆ™æ˜¯è¢«é¢å‘çš„**å®¢æˆ·ç«¯è¯ä¹¦**ã€‚

```bash
kubectl get secret/nfs-client-provisioner-token-8lnmq -o yaml
```

![image-20210609150127563](./img/image-20210609150127563.png)



å¯¹åº”ä½¿ç”¨äº†è¯¥ *ServiceAccount* çš„ *Pod* å¦‚ä¸‹ï¼Œå¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°æŒ‡å®š *ServiceAccount* å¯¹åº” *Secret* ä¸­çš„**è¯ä¹¦**ï¼Œ**namespace** å’Œ**è®¤è¯ token** ä¼šåˆ†åˆ«ä»¥**æ–‡ä»¶çš„å½¢å¼**æŒ‚è½½åˆ°å®¹å™¨ä¸­çš„æŒ‡å®šç›®å½•ä¸‹ã€‚

![image-20210609151235632](./img/image-20210609151235632.png)



## RBAC

å½“ä¸€ä¸ªè¯·æ±‚åœ¨å®Œæˆ API Server **è®¤è¯**åï¼Œä¾¿å¯è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ª**åˆæ³•ç”¨æˆ·**ï¼Œä¹‹åä¾¿è¿›å…¥**API è¯·æ±‚è®¿é—®æ§åˆ¶**çš„ç¬¬äºŒæ­¥ **Kubernetes é‰´æƒ**ã€‚API Server æœ¬èº«**æ”¯æŒå¤šç§é‰´æƒæ–¹å¼**ï¼Œæˆ‘ä»¬ä¸»è¦ä»‹ç»åœ¨å®‰å…¨ä¸Šæ¨èçš„é‰´æƒæ–¹å¼ **RBAC**ã€‚



### æ ¸å¿ƒè¦ç´ 

**RBAC** ä¸­ä¸‰ä¸ªæœ€æ ¸å¿ƒçš„è¦ç´ å³**ä¸»ä½“ï¼ˆSubjectï¼‰**ï¼Œ**å¯¹è±¡ï¼ˆAPI Resourcesï¼‰**ï¼Œ**æ“ä½œï¼ˆVerbsï¼‰**ã€‚ç›´è§‚çš„ç†è§£å°±æ˜¯ *â€œå®šä¹‰äº†ä»€ä¹ˆäººï¼Œå¯ä»¥å¯¹ä»€ä¹ˆå¯¹è±¡ï¼Œæ‰§è¡Œä»€ä¹ˆæ“ä½œçš„ä¸€ç»„è§„åˆ™â€*ã€‚

![image-20210608140349304](./img/image-20210608140349304.png)

- **Subjects**ï¼šä¸»ä½“ã€‚å¯ä»¥æ˜¯å¼€å‘äººå‘˜ï¼Œé›†ç¾¤ç®¡ç†å‘˜è¿™æ ·çš„**è‡ªç„¶äºº**ï¼›ä¹Ÿå¯ä»¥æ˜¯**ç³»ç»Ÿç»„ä»¶è¿›ç¨‹**ï¼Œæˆ–è€…æ˜¯ Pod ä¸­çš„**é€»è¾‘è¿›ç¨‹**ã€‚
- **API Resource**ï¼šå³è¯·æ±‚å¯¹åº”çš„è®¿é—®ç›®æ ‡ã€‚åœ¨ Kubernetes é›†ç¾¤ä¸­ä¹Ÿå°±æ˜¯å„ç±»**èµ„æº**ã€‚
- **Verbs**ï¼šå¯¹åº”è¯·æ±‚å¯¹è±¡èµ„æºå¯ä»¥è¿›è¡Œå“ªäº›æ“ä½œï¼ŒåŒ…æ‹¬å¢åˆ æ”¹æŸ¥ï¼Œå¦‚ `LIST`ï¼Œ`GET`ï¼Œ`WATCH` ç­‰ç­‰ã€‚



### Role & RoleBinding

æˆ‘ä»¬ä» *Role* å¼€å§‹äº†è§£ï¼Œæ¥çœ‹ä¸€ä»½ç®€å•çš„ *Role* èµ„æºæ¸…å•ã€‚

```yaml
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  namespace: mynamespace
  name: example-role
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "watch", "list"]
```

é¦–å…ˆï¼Œå¾ˆè‡ªç„¶çš„å‘ç°ï¼Œ*Role* æ˜¯ **namespaced** çš„ï¼Œå³å®ƒä»…èƒ½åœ¨ç‰¹å®šçš„ *Namespace* ä¸‹ç”Ÿæ•ˆï¼Œæœ¬ä¾‹ä¸­ä¸º **mynamespace**ã€‚è‹¥æœªæŒ‡å®š `namespace` å­—æ®µï¼Œåˆ™é»˜è®¤ä¸º **default**ã€‚ 

æ¸…å•ä¸­çš„ `rules` å­—æ®µï¼Œå°±æ˜¯å®ƒæ‰€å®šä¹‰çš„**æƒé™è§„åˆ™**ã€‚æ­¤å¤„çš„**è¯­ä¹‰**ä¸ºï¼šå…è®¸â€œ**è¢«ä½œç”¨è€…**â€ï¼Œå¯¹ **mynamespace** ä¸‹é¢çš„ *Pod* ï¼Œè¿›è¡Œ `GET`ï¼Œ`WATCH` å’Œ `LIST` æ“ä½œã€‚æ³¨æ„ *pod* å±äº **API Core Groups**ï¼Œæ ¸å¿ƒ API æ— ç»„æ¦‚å¿µï¼Œæ‰€ä»¥ `apiGroups` å­—æ®µä¸ºä¸€å¯¹**ç©ºå¼•å·**ã€‚



è€Œ *RoleBinding* åˆ™ç”¨äºæ¥å…³è”â€œ**è¢«ä½œç”¨è€…**â€ä¸ *Role*ï¼Œâ€œ**è¢«ä½œç”¨è€…**â€å°±æ˜¯æˆ‘ä»¬ä¹‹å‰æ‰€äº†è§£çš„ **Kubernetes è®¤è¯**è¿‡ç¨‹ä¸­æ‰€äº§ç”Ÿçš„**ç”¨æˆ·æ¨¡å‹**ã€‚

```yaml
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: example-rolebinding
  namespace: mynamespace
subjects:
- kind: User
  name: example-user
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: example-role
  apiGroup: rbac.authorization.k8s.io
```

å…¶ä¸­ï¼Œ`subjects` å­—æ®µå³å®šä¹‰äº†â€œ**è¢«ä½œç”¨è€…**â€ï¼Œå…¶ç±»å‹ä¸º *User*ï¼Œä¹‹å‰å·²ç»æåˆ°è¿‡äº†ï¼Œå®ƒåªæ˜¯ä¸€ä¸ª**é€»è¾‘æ¦‚å¿µ**ï¼Œå¹¶ä¸æ˜¯çœŸæ­£çš„ **Kubernetes API å¯¹è±¡**ã€‚åŒæ ·çš„ã€‚

`roleRef` å­—æ®µåˆ™é€šè¿‡åå­—å¼•ç”¨äº†æˆ‘ä»¬åˆšå®šä¹‰çš„ *Role* å¯¹è±¡ï¼Œä»è€Œæ„å»ºäº†â€œ**è¢«ä½œç”¨è€…**â€å’Œâ€œ**è§’è‰²**â€ä¹‹é—´çš„ç»‘å®šå…³ç³»ã€‚éœ€è¦å†æ¬¡æé†’çš„æ˜¯ï¼Œ*Role* å’Œ *RoleBinding* åŒä¸º **namespaced å¯¹è±¡ï¼ˆNamespaced Objectï¼‰**ï¼Œå®ƒä»¬å¯¹æƒé™çš„é™åˆ¶è§„åˆ™**ä»…åœ¨å…¶è‡ªèº«çš„ *Namespace* å†…æœ‰æ•ˆ**ï¼Œ`roleRef`  å­—æ®µä¹Ÿåªèƒ½å¼•ç”¨å½“å‰ *Namespace* é‡Œçš„ *Role* å¯¹è±¡ã€‚



### ClusterRole & ClusterRoleBinding

å¯¹äº**é namespaced å¯¹è±¡ï¼ˆNon-namespaced Objectï¼‰**å¦‚ *node*ï¼Œæˆ–è€…æŸä¸€ä¸ª *Role* æƒ³è¦ä½œç”¨äºæ‰€æœ‰çš„ *Namespace* çš„æ—¶å€™ï¼Œå°±éœ€è¦ä½¿ç”¨ *ClusterRole* å’Œ *ClusterRoleBinding* çš„ç»„åˆäº†ã€‚è¿™ä¸¤ä¸ª API å¯¹è±¡çš„ç”¨æ³•å’Œ *Role* ä¸ *RoleBinding* å®Œå…¨ä¸€è‡´ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯åœ¨å®ƒä»¬çš„å®šä¹‰ä¸­ï¼Œå‡æ—  `namespace` å­—æ®µã€‚

```yaml
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: example-clusterrole
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "watch", "list"]

```

```yaml
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: example-clusterrolebinding
subjects:
- kind: User
  name: example-user
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: example-clusterrole
  apiGroup: rbac.authorization.k8s.io
```

ä¸Šè¿°ç»„åˆæ‰€æè¿°çš„**è¯­ä¹‰**ä¸ºï¼šexample-user ç”¨æˆ·æ‹¥æœ‰å¯¹æ‰€æœ‰ *Namespace* ä¸­çš„ *Pod* è¿›è¡Œ `GET`ï¼Œ`WATCH` å’Œ `LIST` æ“ä½œçš„æƒé™ã€‚



è¿›ä¸€æ­¥çš„ï¼Œå‡è‹¥åœ¨ *Role* æˆ– *ClusterRole* ä¸­æƒ³è¦èµ‹äºˆç”¨æˆ· example-user **æ‰€æœ‰æƒé™**ï¼Œåˆ™å¯ä»¥ç»™å®ƒæŒ‡å®šä¸€ä¸ª `verbs` å­—æ®µçš„**å…¨é›†**ã€‚

```yaml
verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
```

å¯¹ä¸€ä¸ª**åº”ç”¨å¼€å‘äººå‘˜**æ¥è¯´ï¼Œkubectl è‚¯å®šæ›´ä¸ºç›´è§‚ä¸ç†Ÿæ‚‰ï¼Œè¿™é‡Œä¹Ÿç»™å‡ºä¸€äº› kubectl æ“ä½œå’Œ RBAC ä¸­çš„å¯¹åº”å…³ç³»ã€‚

| kubectl                                                      | RBAC                                         |
| ------------------------------------------------------------ | -------------------------------------------- |
| kubectl get deploy -w                                        | *Deployment*ï¼š`GET` `LIST` `WATCH`           |
| kubectl delete deploy test                                   | *Deployment*ï¼š`GET` `DELETE`                 |
| kubectl run --image=nginx nginx-text                         | *Deployment*ï¼š`CREATE`                       |
| kubectl edit deploy nginx-text                               | *Deployment*ï¼š`GET` `PATCH`                  |
| kubectl exec -it pod-test bash                               | *Pods*ï¼š`GET` `CREATE`                       |
| kubectl expose deploy nginx-test --port=80 --target-port=8000 | *Deployment*ï¼š`GET`<br />*Service*ï¼š`CREATE` |



ç±»ä¼¼çš„ï¼Œ*Role* æˆ– *ClusterRole* ä¸­çš„ `rules` å­—æ®µä¹Ÿå¯ä»¥è¿›ä¸€æ­¥ç»†åŒ–ã€‚ä½ å¯ä»¥**åªé’ˆå¯¹æŸä¸€ä¸ªå…·ä½“çš„å¯¹è±¡**è¿›è¡Œæƒé™è®¾ç½®ã€‚

```yaml
rules:
- apiGroups: [""]
  resources: ["configmaps"]
  resourceNames: ["my-config"]
  verbs: ["get"]
```



å¦‚æœæƒ³è¦åœ¨ *RoleBinding* å’Œ *ClusterRoleBinding* ä½¿ç”¨ Kubernetes çš„â€œ**å†…ç½®ç”¨æˆ·**â€ *ServiceAccount*ï¼Œå¯ä»¥è¿™æ ·å®šä¹‰ã€‚

```yaml
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: example-rolebinding
  namespace: mynamespace
subjects:
- kind: ServiceAccount
  name: example-sa
  namespace: mynamespace
roleRef:
  kind: Role
  name: example-role
  apiGroup: rbac.authorization.k8s.io
```



åŒæ ·çš„ï¼ŒKubernetes ä¹Ÿæœ‰**ç”¨æˆ·ç»„** *Group* çš„æ¦‚å¿µã€‚å°† *RoleBinding* å’Œ *ClusterRoleBinding* ä¸­çš„ `Kind` å­—æ®µè®¾ç½®ä¸º *Group* å³å¯ï¼Œä¹‹å‰çš„**X.509 è¯ä¹¦è®¤è¯**æ–¹å¼ä¸­çš„ **O** å…¶å®å°±ä¸ä¹‹å¯¹åº”ã€‚

å®é™…ä¸Šï¼Œä¸€ä¸ª *ServiceAccount* åœ¨ Kubernetes ä¸­å¯¹åº”çš„å®Œæ•´ *User* åä¸ºï¼š`system:serviceaccount:<ServiceAccount åå­—>`ï¼Œå…¶å¯¹åº”çš„**å†…ç½®** *Group* åä¸ºï¼š`system:serviceaccounts:<namespace åå­—>`ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰ä¸Šè¿° *RoleBinding* ä¸­çš„  `subjects`ã€‚

```yaml
subjects:
- kind: Group
  name: system:serviceaccounts:mynamespace
  apiGroup: rbac.authorization.k8s.io
```

è¿™å°±æ„å‘³ç€è¿™ä¸ª *Role* çš„æƒé™è§„åˆ™å¯ä½œç”¨äº mynamespace é‡Œçš„æ‰€æœ‰ *ServiceAccount*ã€‚



### é¢„è®¾ ClusterRole

ç°åœ¨æˆ‘ä»¬åº”è¯¥èƒ½ç†è§£ï¼Œè‹¥åœ¨ä¸è¿›è¡Œä»»ä½•æƒé™çš„ç»‘å®šä¸‹ï¼ŒRABC ä¼š**æ‹’ç»æ‰€æœ‰çš„è®¿é—®**ã€‚é‚£ä¹ˆ Kubernetes çš„**ç³»ç»Ÿç»„ä»¶**æ˜¯å¦‚ä½•é‰´æƒçš„å‘¢ï¼Ÿç”¨æˆ·å…¶å®å¹¶æ²¡æœ‰ä¸ºè¯¸å¦‚**è°ƒåº¦å™¨ï¼ˆschedulerï¼‰**ç­‰åˆ›å»ºä»»ä½•è§’è‰²ã€‚



å…¶å®åœ¨é›†ç¾¤åˆ›å»ºæ—¶ï¼Œä¼´éšç€å¤„ç†ç³»ç»Ÿå„ç»„ä»¶çš„**å®¢æˆ·ç«¯è¯ä¹¦**ï¼Œå…¶å„è‡ªçš„**è§’è‰²**ä¸**ç¯å¢ƒå¯¹è±¡**ä¹Ÿä¼šè¢«åˆ›å»ºå‡ºæ¥ï¼Œè¿™æ˜¯ Kubernetes å†…ç½®çš„å¾ˆå¤šä¸ªä¸º**ç³»ç»Ÿä¿ç•™**çš„ *ClusterRole*ï¼Œå®ƒä»¬çš„åå­—å‡ä»¥ `system:` å¼€å¤´ã€‚

```bash
kubectl get clusterroles -n kube-system | grep system:
```

![image-20210610101624475](./img/image-20210610101624475.png)

ä¸€èˆ¬æ¥è¯´ï¼Œè¿™äº›ç³»ç»Ÿ *ClusterRole*ï¼Œæ˜¯ç»‘å®šç»™ Kubernetes ç³»ç»Ÿç»„ä»¶å¯¹åº”çš„ *ServiceAccount* ä½¿ç”¨çš„ã€‚



é™¤æ­¤ä¹‹å¤–ï¼ŒKubernetes è¿˜æä¾›äº†å››ä¸ª**é¢„å…ˆå®šä¹‰**å¥½çš„ *ClusterRole* æ¥ä¾›ç”¨æˆ·ç›´æ¥ä½¿ç”¨ï¼š

- **cluster-amdin**
- **admin**
- **edit**
- **view**



å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ**cluster-amdin** è§’è‰²ï¼Œå¯¹åº”çš„æ˜¯æ•´ä¸ª Kubernetes é¡¹ç›®ä¸­çš„æœ€é«˜æƒé™ï¼ˆ**Resources=\*.\***ï¼Œ **Verbs=\***ï¼‰,æ‰€è¯·åŠ¡å¿…å°å¿ƒä½¿ç”¨ **cluster-amdin** è§’è‰²ã€‚

```bash
kubectl describe clusterrole cluster-admin -n kube-system
```

![image-20210610102017816](./img/image-20210610102017816.png)





